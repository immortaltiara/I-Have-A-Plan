# 总结

***

## 网易MG复赛

***

7.16-7.22

这周基本所有时间都在肝网易的复赛项目，总结为：搭场景，搭场景和搭场景等无聊却爆肝的工作，深夜对着几个物体一点点调位置的感受真是一言难尽

## 心动夏令营

***

7.23-7.29

​     本周可以好好投入心动夏令营的项目了，内容是一个AI坦克大战，成员们需要用各自的AI坦克互相对抗，一轮了来决出获胜者。本次活动的游戏已经有了完整的框架并提供了接口，我们的任务就集中在完善自己的AI脚本。

​     从来没有接触过AI的我还是挺慌的，早早开始构思。一开始 ，我花了时间了解行为树，也试了一下现有的框架，但由于本来的思路已经较为完善，看了一天后着手以之前的思路为基础编写。

### 游戏规则

普通子弹一发3血，坦克总血量10血。

子弹击中敌人+1分，击杀敌人+3分，死亡不扣分，复活10s。总体是鼓励进攻的打法。

地图上固定地点刷新道具，分为三大类：

**护盾：**最强道具，在地图中心刷新。可以抵挡三次伤害，攻击者不加分。

**HPup：**共四个，分布在地图四周，捡起回复部分血量。

**子弹：**两个红子弹和两个蓝子弹，红字弹伤害为5，算是大幅提高了伤害，面对最多四下的击杀变为最多两下；蓝子弹：让子弹碰到墙壁时不爆炸，而是回弹，实测比较鸡肋。

### 基本思路

设定一个enum，包括几个坦克的基本状态，起到决定坦克移动方向的作用，初始分为道具和敌人，以及躲避子弹。始终有个唯一锁定的目标道具和目标敌人。当锁定道具为null，则状态切换为追击敌人。

护盾存在时，护盾为目标道具；当护盾不存在：坦克血量<总血量的0.69时，最近的hp为目标，不满足时，则小范围内的道具做为目标，路过时会捡起（包括子弹和不为满血时的hp），而以上都不满足时，锁定道具为null。每帧会刷新所有敌人信息，将敌人和自身的距离、敌人血量护盾值等通过合适的权值计算并排序，将第一位作为锁定目标。

而当附近有子弹时，躲子弹通常为最优先移动。通过子弹速度的射线检测计算出一个直角的移动策略，并且如果目标方向有墙体，则改变方向。

射击的方向预判我写了个返回坐标点的方法，参数类型是坦克的属性类，用余弦定理手算好方程后写的。。这功能总体没什么亮点。

update调用如下：

```

        override protected void OnUpdate()
        {
            base.OnUpdate();
            refreshInrangeBullets();
            refreshAllPlayers();
            refreshAllPickups();
            refreshInsmallrangeEnemies();
            refreshInrangeEnemies();
            refreshInrangeItems();

            setLockedPlayer();
            setLockedItem();

            manageAim();
            moveToTarget();
        }
```

OnFixedUpdate中指定射击目标（同优先级最高玩家），与移动方向模块分离。

```

           
        override protected void OnFixedUpdate()
        {
           if(allPlayers.Count>0)
            {
                AimAndShoot(targetPosition(allPlayers[0].GetComponent<BasePlayer>()));
            }
        }
```

主体写完只花了一天（包括了躲避功能和预判），后来没事做，就是调调参数，还加了计算护盾刷新时间，并按适当时间在旁边等待的功能，但有些瑕疵。我是计时算的，死亡时不计入 所以我会将值重置，不能获取准确刷新时间。而其实脚本里是有刷新时间可获取的，我之前浏览是也看到了，但没放心上。而这个瑕疵也导致了后来一场比赛的边际效应。

### 实战结果与总结

在测试约战中，我去掉躲避功能纯测试策略，表现仍然非常亮眼，除了被一个吊打一切的坦克吊打以外，可以吊打其他人。最后一天的开黑中，大家都爆肝做出了很多改进，虽然能得第一，但不能像原来一样吊打了。

在最后的比赛，前两轮小组赛都是第一，半决赛中遇到第一轮被我打败的一个坦克，以为稳了，但出乎意料的是，这场比赛我从头到尾都是最后一名，最终没能进决赛。这次的比赛由于一开始没有抢到盾，失去优势，后来的被击杀更是削弱了我对盾牌的竞争力，上文提到的边际效应在这次比赛中充分显露，所以可以看出我这次的结果有很多不足的地方，但也是我对游戏AI的第一次接触，觉得挺有意思。活动中有机会认识很多朋友，也见识到了心动网络的环境，整个过程非常有趣，十分有意义。
